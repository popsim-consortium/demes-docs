
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Development &#8212; Demes manual</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="CHANGELOG.html" />
    <link rel="prev" title="Command line interface" href="cli.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Demes manual</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="introduction.html">
   Introduction
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="quickstart.html">
   Quickstart
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="api.html">
   API Reference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cli.html">
   Command line interface
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CHANGELOG.html">
   Changelog
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  demes 0.1.3.dev61
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/development.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/popsim-consortium/demes-python"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/popsim-consortium/demes-python/issues/new?title=Issue%20on%20page%20%2Fdevelopment.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/popsim-consortium/demes-python/edit/main/docs/development.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#continuous-integration-ci">
   Continuous integration (CI)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lint-checks">
   Lint checks
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-commit">
     Pre-commit
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#test-suite">
   Test suite
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-the-documentation">
   Building the documentation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#releasing-a-new-version">
   Releasing a new version
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="development">
<span id="sec-development"></span><h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>We welcome all contributors! Contributions to <code class="docutils literal notranslate"><span class="pre">demes</span></code> typically take the form
of “pull requests” against our
<a class="reference external" href="https://github.com/popsim-consortium/demes-python">git repository</a>.</p>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Demes</span></code> aims to have minimal dependencies when used as a library by other
projects. However, additional dependencies are required during development, as
developers regularly run the test suite, build the documentation, and assess
whether their code changes conform to style guidelines. The <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>
file in the top-level folder lists all development dependencies, which can
be installed using <code class="docutils literal notranslate"><span class="pre">pip</span></code>. In the following documentation, we assume the reader
has cloned the source repository and installed the developer requirements as
follows.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clone the repository.</span>
git clone https://github.com/popsim-consortium/demes-python.git
<span class="nb">cd</span> demes-python
<span class="c1"># Install the developer dependencies.</span>
python -m pip install -r requirements.txt
<span class="c1"># Generate the version string from the most recent git tag/commit.</span>
python setup.py build
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Non-developer requirements are listed in the <code class="docutils literal notranslate"><span class="pre">install_requires</span></code> section
of the <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file in the top-level folder of the sources.</p>
</div>
</div>
<div class="section" id="continuous-integration-ci">
<h2>Continuous integration (CI)<a class="headerlink" href="#continuous-integration-ci" title="Permalink to this headline">¶</a></h2>
<p>After a pull request is submitted, an automated process known as
<em>continuous integration</em> (CI) will:</p>
<ul class="simple">
<li><p>assess if the proposed changes conform to style guidelines (known as <em>lint</em> checks),</p></li>
<li><p>run the test suite,</p></li>
<li><p>and build the documentation.</p></li>
</ul>
<p>The CI process uses
<a class="reference external" href="https://docs.github.com/en/free-pro-team&#64;latest/actions">GitHub Actions</a>
and the configuration files detailing how these are run can be found under the
<code class="docutils literal notranslate"><span class="pre">.github/workflows/</span></code> folder of the sources.</p>
</div>
<div class="section" id="lint-checks">
<h2>Lint checks<a class="headerlink" href="#lint-checks" title="Permalink to this headline">¶</a></h2>
<p>The following tools are run during the linting process:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://black.readthedocs.io/">black</a>, a code formatter
(code is only checked during CI, not reformatted),</p></li>
<li><p><a class="reference external" href="https://flake8.pycqa.org/">flake8</a>,
a <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> code-style checker,</p></li>
<li><p><a class="reference external" href="http://mypy-lang.org/">mypy</a>, a static type checker.</p></li>
</ul>
<p>Each of these tools can also be run manually from the top-level folder of the
sources. The <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file includes some project-specific configuration
for each of these tools, so running them from the command line should match
the behaviour of the CI checks.</p>
<p>For example, to reformat the code with <code class="docutils literal notranslate"><span class="pre">black</span></code> after making changes to the
<code class="docutils literal notranslate"><span class="pre">demes/demes.py</span></code> file (command output shown as comments):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>black .
<span class="c1"># reformatted /home/grg/src/demes/demes/demes.py</span>
<span class="c1"># All done! ✨ 🍰 ✨</span>
<span class="c1"># 1 file reformatted, 14 files left unchanged.</span>
</pre></div>
</div>
<p>Similarly, one can check conformance to PEP8 style guidelines by running
<code class="docutils literal notranslate"><span class="pre">flake8</span></code> (without parameters), and check type annotations by running
<code class="docutils literal notranslate"><span class="pre">mypy</span></code> (also without parameters).</p>
<div class="section" id="pre-commit">
<h3>Pre-commit<a class="headerlink" href="#pre-commit" title="Permalink to this headline">¶</a></h3>
<p>To simplify the process of running each of the linter tools, we also
include a configuration for the <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> program. If you prefer not
to run each of the commands above manually, install the <code class="docutils literal notranslate"><span class="pre">pre-commit</span></code> Python
package and then run <code class="docutils literal notranslate"><span class="pre">pre-commit</span> <span class="pre">install</span></code> from the top-level folder of your
cloned demes repository. Now when you try to commit changes, the lint
checks will be performed automatically. If pre-commit made changes to the
files when you tried to commit, you’ll need to stage those changes and
try again. E.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">add</span> <span class="pre">-u;</span> <span class="pre">git</span> <span class="pre">commit</span></code>.
See the <a class="reference external" href="https://pre-commit.com/">pre-commit documentation</a> for more details.</p>
</div>
</div>
<div class="section" id="test-suite">
<h2>Test suite<a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h2>
<p>A suite of tests is included in the <code class="docutils literal notranslate"><span class="pre">tests/</span></code> folder.
The CI process uses the <code class="docutils literal notranslate"><span class="pre">pytest</span></code> tool to run the tests, which can also be run
manually from the top-level folder of the sources.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python -m pytest -v tests --cov<span class="o">=</span>demes --cov-report<span class="o">=</span>term-missing
</pre></div>
</div>
<p>This will produce lots of output, indicating which tests passed, and which
failed (if any). There may also be warnings. Any warnings that are triggered
by code in <code class="docutils literal notranslate"><span class="pre">demes</span></code> (rather than third-party libraries), should be fixed.</p>
<p>It is expected that new code contributions will be tested by the introduction
of new tests in the test suite. While we don’t currently have any strict
requirements for code coverage, more is better. Furthermore, we encourage
contributions that improve, or expand on, the existing suite of tests.</p>
</div>
<div class="section" id="building-the-documentation">
<h2>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">demes</span></code> documentation is built with <a class="reference external" href="https://jupyter-book.org/">jupyter-book</a>,
which uses <a class="reference external" href="https://www.sphinx-doc.org/">sphinx</a>.
Much of the documentation is under the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder, written in the
<a class="reference external" href="https://myst-parser.readthedocs.io/en/latest/">MyST</a> flavour of Markdown,
and is configured in the <code class="docutils literal notranslate"><span class="pre">docs/_config.yml</span></code> file.
In contrast, the API documentation is automatically generated from “docstrings”
in the Python code that use the
<a class="reference external" href="https://docutils.sourceforge.io/docs/ref/rst/restructuredtext.html">reStructuredText</a>
format. To build the documentation locally, run <code class="docutils literal notranslate"><span class="pre">make</span></code> from the <code class="docutils literal notranslate"><span class="pre">docs/</span></code> folder.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> docs
make
</pre></div>
</div>
<p>If this was successful, the generated documentation can be viewed in a browser
by navigating to the <code class="docutils literal notranslate"><span class="pre">docs/_build/html/index.html</span></code> file. It is expected that
new code contributions will be accompanied by relevant documentation (e.g. a
new function will include a docstring).</p>
<p>We strongly encourage contributions that improve the <code class="docutils literal notranslate"><span class="pre">demes</span></code> documentation,
such as fixing typos and grammatical errors, or making the documentation
clearer and/or more accessible.</p>
</div>
<div class="section" id="releasing-a-new-version">
<h2>Releasing a new version<a class="headerlink" href="#releasing-a-new-version" title="Permalink to this headline">¶</a></h2>
<p>See tskit docs on making a release:
<a class="reference external" href="https://tskit.readthedocs.io/en/latest/development.html#releasing-a-new-version">https://tskit.readthedocs.io/en/latest/development.html#releasing-a-new-version</a></p>
<p>Prepare for the release by updating the <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code>. The version here
should have the format MAJOR.MINOR.PATCH, or for a beta release
MAJOR.MINOR.PATCHbX, e.g. 1.0.0b1. Commit the changes to the changelog;
make pull request; merge.</p>
<p>Tag release.</p>
<ul class="simple">
<li><p>E.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">tag</span> <span class="pre">0.1.0</span></code></p></li>
</ul>
<p>Build distribution files, and test on testpypi.</p>
<ul class="simple">
<li><p>See <a class="reference external" href="https://packaging.python.org/tutorials/packaging-projects/#generating-distribution-archives">https://packaging.python.org/tutorials/packaging-projects/#generating-distribution-archives</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">build</span> <span class="pre">twine</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-fr</span> <span class="pre">dist/</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-m</span> <span class="pre">build</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">check</span> <span class="pre">dist/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">upload</span> <span class="pre">--repository</span> <span class="pre">testpypi</span> <span class="pre">dist/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">demes</span></code></p></li>
<li><p>Check it installs:
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--upgrade</span> <span class="pre">--pre</span> <span class="pre">--extra-index-url</span> <span class="pre">https://test.pypi.org/simple/</span> <span class="pre">demes</span></code>.</p></li>
<li><p>Check it imports: <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">-c</span> <span class="pre">&quot;import</span> <span class="pre">demes&quot;</span></code>.</p></li>
<li><p>Check the CLI: <code class="docutils literal notranslate"><span class="pre">demes</span> <span class="pre">--help</span></code>.</p></li>
<li><p>Check the (test) pypi splash page: <a class="reference external" href="https://test.pypi.org/project/demes/">https://test.pypi.org/project/demes/</a></p></li>
</ul>
<p>Upload to pypi.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">twine</span> <span class="pre">upload</span> <span class="pre">--repository</span> <span class="pre">pypi</span> <span class="pre">dist/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">uninstall</span> <span class="pre">demes</span></code></p></li>
<li><p>Check it installs: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">demes</span> <span class="pre">--upgrade</span> <span class="pre">--pre</span></code>.</p></li>
</ul>
<p>Push release.</p>
<ul class="simple">
<li><p>E.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span> <span class="pre">origin</span> <span class="pre">0.1.0</span></code></p></li>
<li><p>Create a release in the GitHub UI, based on the tag that was pushed.</p></li>
</ul>
<p>Finally, update <code class="docutils literal notranslate"><span class="pre">CHANGELOG.md</span></code> to start a section for the next release cycle.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="cli.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Command line interface</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="CHANGELOG.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Changelog</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By PopSim Consortium<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            demes 0.1.3.dev61
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>